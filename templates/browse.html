{% extends "base.html" %}

{% block title %}{{ category|title }} - ShiRo{% endblock %}

{% block head %}
<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/browse.css') }}">
{% endblock %}

{% block content %}
<div class="container browse-container">
    <div class="browse-header">
        <h2 class="browse-title">{{ category|title|replace('-', ' ') }}</h2>
    </div>
    
    {% if data %}
        <div class="anime-grid">
            {# Robustly handle list vs dict #}
            {% set anime_list = data.results if data.results is defined else data %}
            
            {% if anime_list %}
                {% for anime in anime_list %}
                <a href="/anime/{{ anime.id }}" class="anime-card-link" style="display: block; text-decoration: none;">
                    <div class="anime-card">
                        <div class="poster-wrapper skeleton">
                            <img src="{{ anime.image }}" alt="{{ anime.title }}" loading="lazy" onload="this.parentElement.classList.add('loaded'); this.parentElement.classList.remove('skeleton');">
                        </div>
                        <div class="play-icon"><i class="fa-solid fa-play"></i></div>
                        
                        <div class="anime-card-overlay">
                            <div class="card-title">{{ anime.title }}</div>
                            <div class="card-meta">
                                <span>{{ anime.releaseDate or 'N/A' }}</span>
                                {% if anime.subOrDub %} â€¢ <span>{{ anime.subOrDub|upper }}</span>{% endif %}
                            </div>
                        </div>
                    </div>
                </a>
                {% endfor %}
            {% else %}
               <div class="no-data">No anime found in this category.</div>
            {% endif %}
        </div>
        
        {# Pagination Logic - Only show if we suspect more pages #}
        {# Some APIs return hasNextPage, others don't. We'll show Next if we have a full page of results (usually 20+) #}
        {% if (data.hasNextPage is defined and data.hasNextPage) or (anime_list|length >= 20) or page > 1 %}
        <div class="pagination">
            {% if page > 1 %}
            <a href="?page={{ page - 1 }}"><i class="fa-solid fa-chevron-left"></i> Previous</a>
            {% endif %}
            
            <span class="current">Page {{ page }}</span>
            
            {% if (data.hasNextPage is defined and data.hasNextPage) or (anime_list|length >= 20) %}
            <a href="?page={{ page + 1 }}">Next <i class="fa-solid fa-chevron-right"></i></a>
            {% endif %}
        </div>
        {% endif %}
        
    {% else %}
        <div class="no-data">
            <p>Unable to load content at the moment.</p>
        </div>
    {% endif %}
</div>
{% endblock %}