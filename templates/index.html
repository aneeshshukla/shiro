{% extends "base.html" %}

{% block head %}
<!-- Material Symbols for Icons -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
{% endblock %}

{% block content %}
    <!-- Hero Section -->
    {% if spotlight %}
    <section class="hero-section">
        <div class="hero-slider">
            {% set spotlight_list = spotlight.results if spotlight.results is defined else spotlight %}
            {% for anime in spotlight_list %} 
            <div class="hero-slide {% if loop.index == 1 %}active{% endif %}" data-index="{{ loop.index0 }}">
                <img src="{{ anime.banner or anime.image }}" alt="{{ anime.title }}" class="hero-background">
                <div class="hero-gradient"></div>
                <div class="hero-content">
                    <h1 class="hero-title">{{ anime.title }}</h1>
                    <div class="hero-meta">
                        <span class="meta-badge quality">HD</span>
                        <span class="meta-badge sub"><i class="fa-solid fa-closed-captioning"></i> {{ anime.sub or '?' }}</span>
                        {% if anime.dub and anime.dub != '0' %}<span class="meta-badge dub"><i class="fa-solid fa-microphone"></i> {{ anime.dub }}</span>{% endif %}
                        <span style="color: #fff; font-weight: 600;">{{ anime.type or 'TV' }}</span>
                        <span style="color: #ccc;">{{ anime.releaseDate }}</span>
                    </div>
                    <p class="hero-description">{{ anime.description }}</p>
                    <div class="hero-buttons">
                        <a href="/watch/{{ anime.id }}" class="hero-btn hero-btn-primary">WATCH NOW</a>
                        <a href="/anime/{{ anime.id }}" class="hero-btn hero-btn-secondary"><i class="fa-solid fa-info"></i></a>
                    </div>
                </div>
            </div>
            <!-- Pagination Indicators style -->
            <div class="slide-controls {% if loop.index == 1 %}active{% endif %}" data-index="{{ loop.index0 }}" style="position: absolute; bottom: 50px; right: 50px; color: white; font-weight: 700; z-index: 10;">
                <i onclick="prevSlide()" class="fa-solid fa-chevron-left" style="margin-right: 15px; cursor: pointer;"></i>
                {{ loop.index }} / {{ spotlight_list|length }}
                <i onclick="nextSlide()" class="fa-solid fa-chevron-right" style="margin-left: 15px; cursor: pointer;"></i>
            </div>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <section class="hero-section" style="height: 50vh; display: flex; align-items: center; justify-content: center; background: #111;">
        <div style="text-align: center; color: #fff;">
            <h1>Server Unavailable</h1>
            <p>Please check back later.</p>
        </div>
    </section>
    {% endif %}

    <div class="main-content">
        <!-- Flex Container for Content + Sidebar -->
        <div class="content-wrapper" style="display: flex; gap: 30px; flex-wrap: wrap;">
            
            <!-- LEFT COLUMN: Main Lists (75%) -->
            <div style="flex: 3; min-width: 300px;">
                
                <!-- Latest Updates (Existing) -->
                <div class="section-header">
                    <h2 class="section-title">Latest Updates</h2>
                    <div style="color: #888; font-size: 0.9rem;">
                        <span style="color: var(--primary); font-weight: 700;">All</span> 
                        <span style="margin: 0 10px;">Sub</span> 
                        <span>Dub</span>
                    </div>
                </div>

                {% if recent_episodes %}
                <div class="anime-grid">
                    {% set recent_list = recent_episodes.results if recent_episodes.results is defined else recent_episodes %}
                    {% for anime in recent_list[:10] %}
                    <a href="/watch/{{ anime.id }}" class="anime-card-link" style="text-decoration: none;">
                        <div class="anime-card">
                            <img src="{{ anime.image }}" alt="{{ anime.title }}" loading="lazy">
                            <div class="card-badges">
                                <span class="badge-sm badge-cc">CC {{ anime.sub or '?' }}</span>
                                {% if anime.dub != 0 %}<span class="badge-sm badge-mic"><i class="fa-solid fa-microphone"></i> {{ anime.dub or '?' }}</span>{% endif %}
                                {% if anime.type == 'Movie' %}<span class="badge-sm badge-mic">MOV</span>{% endif %}
                            </div>
                            <div class="play-icon"><i class="fa-solid fa-play"></i></div>
                        </div>
                        <div class="anime-card-info">
                            <div class="card-title">{{ anime.title }}</div>
                            <div class="card-meta">{{ anime.type or 'TV' }}</div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- 3-Column Lists: New Releases, Upcoming, Completed -->
                <div class="triple-list-grid">
                    
                    <!-- Col 1: New Releases -->
                    <div class="list-column">
                        <div class="section-header small">
                            <h3 class="column-title">New Releases</h3>
                            <i class="fa-solid fa-arrow-up-right-from-square"></i>
                        </div>
                        <div class="vertical-list">
                            {% set new_list = new_releases.results if new_releases and new_releases.results is defined else (new_releases or []) %}
                            {% for anime in new_list[:6] %}
                            <a href="/anime/{{ anime.id }}" class="v-item">
                                <img src="{{ anime.image }}" alt="{{ anime.title }}">
                                <div class="v-info">
                                    <h4 class="v-title">{{ anime.title }}</h4>
                                    <div class="v-meta">
                                        <span class="badge-outline">CC {{ anime.sub or '?' }}</span>
                                        {% if anime.dub != 0 %}<span class="badge-outline"><i class="fa-solid fa-microphone"></i> {{ anime.dub or '?' }}</span>{% endif %}
                                        <span class="v-type">{{ anime.type or 'TV' }}</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Col 2: Upcoming -->
                    <div class="list-column">
                        <div class="section-header small">
                            <h3 class="column-title">Upcoming</h3>
                            <i class="fa-solid fa-arrow-up-right-from-square"></i>
                        </div>
                        <div class="vertical-list">
                            {% set upcoming_list = upcoming.results if upcoming and upcoming.results is defined else (upcoming or []) %}
                            {% for anime in upcoming_list[:6] %}
                            <a href="/anime/{{ anime.id }}" class="v-item">
                                <img src="{{ anime.image }}" alt="{{ anime.title }}">
                                <div class="v-info">
                                    <h4 class="v-title">{{ anime.title }}</h4>
                                    <div class="v-meta">
                                        <span class="badge-outline">Preview</span>
                                        <span class="v-type">{{ anime.type or 'TV' }}</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Col 3: Completed -->
                    <div class="list-column">
                        <div class="section-header small">
                            <h3 class="column-title">Completed</h3>
                            <i class="fa-solid fa-arrow-up-right-from-square"></i>
                        </div>
                        <div class="vertical-list">
                            {% set completed_list = latest_completed.results if latest_completed and latest_completed.results is defined else (latest_completed or []) %}
                            {% for anime in completed_list[:6] %}
                            <a href="/anime/{{ anime.id }}" class="v-item">
                                <img src="{{ anime.image }}" alt="{{ anime.title }}">
                                <div class="v-info">
                                    <h4 class="v-title">{{ anime.title }}</h4>
                                    <div class="v-meta">
                                        <span class="badge-outline">CC {{ anime.sub or '?' }}</span>
                                        {% if anime.dub != 0 %}<span class="badge-outline"><i class="fa-solid fa-microphone"></i> {{ anime.dub or '?' }}</span>{% endif %}
                                        <span class="v-type">{{ anime.type or 'TV' }}</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                </div>
            </div>

            <!-- RIGHT COLUMN: Schedule Sidebar (25%) -->
            <div class="sidebar" style="flex: 1; min-width: 250px;">
                
                <!-- Top Trending (Moved Up) -->
                <div class="section-header">
                    <h2 class="section-title" style="color: #fff;"><i class="fa-solid fa-ranking-star" style="color: var(--primary); margin-right: 8px;"></i> Top Trending</h2>
                </div>
                
                <div class="release-list" style="margin-bottom: 40px;">
                    {% if new_releases %}
                        {% set trending_list = new_releases.results if new_releases.results is defined else new_releases %}
                        {% for anime in trending_list[:9] %}
                        <a href="/anime/{{ anime.id }}" class="release-item" style="align-items: center; background: transparent; padding: 10px 0; border-bottom: 1px solid #222;">
                            <div style="font-size: 1.2rem; font-weight: 700; color: #444; width: 30px; text-align: center;">{{ loop.index }}</div>
                            <img src="{{ anime.image }}" alt="{{ anime.title }}" style="width: 50px; height: 70px; object-fit: cover; margin: 0 15px;">
                            <div class="release-info">
                                <div class="release-title" style="font-size: 0.9rem; margin-bottom: 5px;">{{ anime.title }}</div>
                                <div class="release-meta" style="font-size: 0.8rem;">
                                    <span class="badge-sm badge-cc">CC {{ anime.sub or '?' }}</span>
                                    {% if anime.dub and anime.dub != 0 %}<span class="badge-sm badge-mic"><i class="fa-solid fa-microphone"></i> {{ anime.dub or '?' }}</span>{% endif %}
                                    <span style="color: #666; margin-left: 5px;">{{ anime.type or 'TV' }}</span>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- Schedule Widget (Moved Down) -->
                <div class="schedule-box">
                    <div class="schedule-header">
                        <div class="sched-nav btn-prev"><i class="fa-solid fa-chevron-left"></i></div>
                        
                        <div class="sched-dates">
                            <div class="sched-day active">
                                <span class="sd-name">SUN</span>
                                <span class="sd-num">01</span>
                            </div>
                            <div class="sched-day">
                                <span class="sd-name">MON</span>
                                <span class="sd-num">02</span>
                            </div>
                            <div class="sched-day">
                                <span class="sd-name">TUE</span>
                                <span class="sd-num">03</span>
                            </div>
                        </div>

                        <div class="sched-nav btn-next"><i class="fa-solid fa-chevron-right"></i></div>
                    </div>

                    <div class="schedule-list">
                        {% if schedule %}
                            {% for item in schedule.results[:9] %}
                            <div class="sched-item">
                                <div class="sched-time">{{ item.airingTime }}</div>
                                <div class="sched-info">
                                    <div class="sched-title">{{ item.title }}</div>
                                    <div class="sched-ep">EP {{ item.airingEpisode }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p style="text-align: center; color: #666; padding: 20px;">No schedule data available.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}